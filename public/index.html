<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CloudKeeper</title>

    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/svg+xml" href="icon.svg" />
    <meta name="theme-color" content="#2563EB" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />

    <!-- Crypto Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>

    <!-- ★ 1. FIREBASE SDK (ဒီကောင်တွေ အရင်လာရမယ်) ★ -->
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- 1. LOGIN SCREEN -->
    <div id="login-view" class="view active">
      <div class="login-card">
        <div class="logo-circle"><i class="fas fa-shield-alt"></i></div>
        <h1>CloudKeeper</h1>
        <p>Your Secure Vault on Google Drive</p>
        <button onclick="handleAuthClick()" class="btn-google">
          <img
            src="https://www.svgrepo.com/show/475656/google-color.svg"
            alt="G"
          />
          Sign in with Google
        </button>
        <p class="note">Encrypted & Stored on your Drive.</p>
      </div>
    </div>

    <!-- ★ MASTER PASSWORD SCREEN (NEW) ★ -->
    <div id="unlock-view" class="view" style="display: none">
      <div class="login-card">
        <div class="logo-circle" style="background: #ecfdf5; color: #10b981">
          <i class="fas fa-key"></i>
        </div>
        <h2 id="unlock-title">Unlock Vault</h2>
        <p class="note" id="unlock-msg">Enter Master Password to Decrypt</p>

        <div class="input-group" style="margin-top: 20px">
          <!-- 
                   Browser ကို လှည့်စားရန်:
                   1. autocomplete="new-password" (အသစ်လို့ပြောရင် Browser က ဖြည့်ပေးဖို့ မကြိုးစားဘူး)
                   2. name="search_term" (Password လို့ နာမည်မပေးဘူး)
                -->
          <input
            type="password"
            id="master-password"
            placeholder="Master Password"
            style="text-align: center; letter-spacing: 2px"
            autocomplete="new-password"
            name="vault_unlock_key_unique"
            readonly
            onfocus="this.removeAttribute('readonly');"
          />
        </div>

        <button
          onclick="unlockVault()"
          class="btn-primary"
          style="margin-top: 10px"
        >
          <i class="fas fa-lock-open"></i>
        </button>

        <p
          class="note"
          style="color: #930e0e; font-size: 13px; margin-top: 15px"
        >
          <i class="fas fa-exclamation-triangle"></i> If you lose this password,
          data is lost forever. <br />
          Security: Do not save this password in browser.
        </p>
      </div>
    </div>

    <!-- 2. DASHBOARD -->
    <div id="app-view" class="view" style="display: none">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="brand">
          <i class="fas fa-shield-alt"></i> <span>Keeper</span>
        </div>

        <div
          onclick="openPaymentUI()"
          class="coffee-btn-icon"
          title="Buy me a coffee"
        >
          <span class="coffee-emoji">☕</span>
        </div>

        <!-- Menu Container (User Panel is now INSIDE for mobile scroll) -->
        <div class="menu-container">
          <button class="menu-item active" onclick="filterData('all')">
            <i class="fas fa-border-all"></i> <span>All Items</span>
          </button>
          <button class="menu-item" onclick="filterData('fav')">
            <i class="fas fa-star text-yellow"></i> <span>Favorites</span>
          </button>

          <div class="menu-label">Categories</div>
          <button class="menu-item" onclick="filterData('social')">
            <i class="fas fa-globe"></i> <span>Social</span>
          </button>
          <button class="menu-item" onclick="filterData('bank')">
            <i class="fas fa-wallet"></i> <span>Finance</span>
          </button>
          <button class="menu-item" onclick="filterData('wireless')">
            <i class="fas fa-wifi"></i> <span>Wireless</span>
          </button>
          <button class="menu-item" onclick="filterData('tv')">
            <i class="fas fa-tv"></i> <span>TV & Ent.</span>
          </button>
          <button class="menu-item" onclick="filterData('auto')">
            <i class="fas fa-car"></i> <span>Auto</span>
          </button>
          <button class="menu-item" onclick="filterData('insurance')">
            <i class="fas fa-file-contract"></i> <span>Insurance</span>
          </button>
          <button class="menu-item" onclick="filterData('home')">
            <i class="fas fa-home"></i> <span>Home</span>
          </button>
          <button class="menu-item" onclick="filterData('work')">
            <i class="fas fa-briefcase"></i> <span>Work</span>
          </button>
          <button class="menu-item" onclick="filterData('other')">
            <i class="fas fa-box-open"></i> <span>Other</span>
          </button>

          <div class="menu-label">Data Management</div>
          <!-- ★ NEW: Backup & Restore ★ -->
          <button class="menu-item" onclick="exportData()">
            <i class="fas fa-file-export"></i> <span>Backup Data</span>
          </button>
          <button
            class="menu-item"
            onclick="document.getElementById('import-file').click()"
          >
            <i class="fas fa-file-import"></i> <span>Restore Data</span>
          </button>
          <!-- Hidden Input for Import -->
          <input
            type="file"
            id="import-file"
            style="display: none"
            onchange="importData(this)"
            accept=".json"
          />

          <!-- Help Button -->
          <button class="menu-item" onclick="openGuide()">
            <i class="fas fa-question-circle"></i> <span>Guide & Privacy</span>
          </button>

          <div class="menu-label">Settings</div>
          <!-- ခေါင်းစဉ်လေးခံလိုက်ရင် ပိုလှပါတယ် -->

          <button class="menu-item" onclick="openChangePassModal()">
            <i class="fas fa-key"></i> <span>Change Password</span>
          </button>

          <!-- User Panel (Moved Inside) -->
          <div class="user-panel">
            <img
              id="user-avatar"
              src=""
              alt="User"
              onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'"
            />

            <div class="user-details">
              <span id="user-name">User</span>
              <button onclick="handleSignoutClick()" class="btn-sm">
                Logout
              </button>
            </div>

            <!-- ★ Mobile Only Logout Button ★ -->
            <!-- CSS မှာ Desktop ဆို display:none လုပ်ထားမယ် -->
            <button
              onclick="handleSignoutClick()"
              class="btn-mobile-logout"
              title="Logout"
            >
              <i class="fas fa-sign-out-alt"></i>
            </button>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-area">
        <!-- ANNOUNCEMENT BANNER -->
        <div
          id="announcementBanner"
          style="display: none"
          class="announcement-box"
        >
          <div class="announce-content">
            <i class="fas fa-bullhorn"></i>
            <span id="announceText">Loading news...</span>
          </div>
          <i
            class="fas fa-times close-announce"
            onclick="closeAnnouncement()"
          ></i>
        </div>

        <header>
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input
              type="text"
              id="search-input"
              placeholder="Search vault..."
              onkeyup="renderList()"
            />
          </div>

          <div class="header-actions">
            <div class="view-toggles">
              <button
                class="btn-toggle active"
                id="btn-grid"
                onclick="toggleView('grid')"
              >
                <i class="fas fa-th-large"></i>
              </button>
              <button
                class="btn-toggle"
                id="btn-list"
                onclick="toggleView('list')"
              >
                <i class="fas fa-list"></i>
              </button>
            </div>
            <button onclick="openModal('add')" class="btn-primary">
              <i class="fas fa-plus"></i> <span class="desk-only">Add New</span>
            </button>
          </div>
        </header>

        <div id="sync-status" class="status-bar hidden">
          <i class="fas fa-sync fa-spin"></i> Syncing with Google Drive...
        </div>

        <div id="data-list" class="grid-layout"></div>
      </main>
    </div>

    <!-- ADD/EDIT MODAL -->
    <div id="entry-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 id="modal-title">
            <i class="fas fa-pen-to-square"></i> New Account
          </h3>
          <span onclick="closeModal('entry-modal')" class="close">&times;</span>
        </div>
        <div class="modal-body">
          <input type="hidden" id="entry-id" />

          <div class="form-grid">
            <div class="input-group">
              <label>Category</label>
              <select id="inp-cat">
                <option value="social">Social Media</option>
                <option value="bank">Finance / Bank</option>
                <option value="wireless">Wireless / Mobile</option>
                <option value="tv">TV / Entertainment</option>
                <option value="auto">Auto / Car</option>
                <option value="insurance">Insurance</option>
                <option value="home">Home / Utilities</option>
                <option value="work">Work / Business</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="input-group">
              <label>Title</label>
              <input type="text" id="inp-title" placeholder="e.g. Netflix" />
            </div>
          </div>

          <!-- ★ NEW: URL INPUT ★ -->
          <div class="input-group">
            <label>Website URL (Optional)</label>
            <div class="icon-input">
              <i class="fas fa-link"></i>
              <input
                type="url"
                id="inp-url"
                placeholder="https://example.com"
              />
            </div>
          </div>

          <div class="input-group">
            <label>Username / Email / ID</label>
            <div class="icon-input">
              <i class="fas fa-user"></i>
              <input type="text" id="inp-user" />
            </div>
          </div>

          <div class="input-group">
            <label>Password</label>
            <div class="pass-box">
              <div class="icon-input">
                <i class="fas fa-key"></i>
                <input type="text" id="inp-pass" />
              </div>
              <button onclick="genPass()" class="btn-gen">
                <i class="fas fa-magic"></i>
              </button>
            </div>
          </div>

          <div class="input-group">
            <label>Notes / Security Q</label>
            <textarea id="inp-note" rows="2"></textarea>
          </div>

          <div class="modal-footer">
            <button onclick="saveEntry()" class="btn-save">
              Save Securely
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- ★ NEW: VIEW DETAILS MODAL (အသေးစိတ်ကြည့်ရန်) ★ -->
    <div id="view-modal" class="modal">
      <div class="modal-content view-card">
        <!-- Header -->
        <div class="view-header-section" id="view-header-bg">
          <button onclick="closeModal('view-modal')" class="view-close-btn">
            &times;
          </button>
          <div class="view-icon-wrapper" id="view-icon-box">
            <i id="view-icon" class="fas fa-shield-alt"></i>
          </div>
          <h3 id="view-title">Title</h3>
          <span id="view-cat" class="view-badge">Category</span>
        </div>

        <div class="modal-body">
          <!-- ★ WEBSITE URL BUTTON (Updated) ★ -->
          <div
            id="view-url-container"
            style="display: none; margin-bottom: 20px; text-align: center"
          >
            <a id="view-url" href="#" target="_blank" class="btn-visit">
              <i class="fas fa-external-link-alt"></i> Open Website
            </a>
          </div>

          <!-- Details Grid -->
          <div class="details-grid">
            <div class="detail-box">
              <label>Username</label>
              <div class="copy-wrapper">
                <span id="view-user">user</span>
                <button onclick="copyText('view-user')" class="btn-copy">
                  <i class="far fa-copy"></i>
                </button>
              </div>
            </div>

            <div class="detail-box">
              <label>Password</label>
              <div class="copy-wrapper">
                <span
                  id="view-pass"
                  class="blur-text"
                  onclick="this.classList.toggle('revealed')"
                  >******</span
                >
                <button onclick="copyText('view-pass')" class="btn-copy">
                  <i class="far fa-copy"></i>
                </button>
              </div>
            </div>
          </div>

          <!-- Notes -->
          <div class="detail-box full-width" style="margin-top: 15px">
            <label>Notes</label>
            <div class="note-content" id="view-note">No notes.</div>
          </div>
        </div>
      </div>
    </div>

    <!-- PROFESSIONAL GUIDE MODAL -->
    <div id="guide-modal" class="modal">
      <div class="modal-content modal-large">
        <div class="modal-header no-border">
          <div class="tab-header">
            <button class="tab-link active" onclick="switchTab('manual')">
              User Manual
            </button>
            <button class="tab-link" onclick="switchTab('policy')">
              Privacy Policy
            </button>
          </div>
          <span onclick="closeGuide()" class="close">&times;</span>
        </div>

        <div class="modal-body scroll-body legal-body">
          <!-- TAB 1: USER MANUAL -->
          <div id="tab-manual" class="tab-content active">
            <div class="doc-header">
              <h4>CloudKeeper User Manual</h4>
              <p>Version 1.0.0</p>
            </div>

            <div class="doc-section">
              <h5>1. Master Password</h5>
              <p>
                When you first use the app, you will set a Master Password. This
                password is used to encrypt your data before sending it to
                Google Drive. We do not store this password.
              </p>
            </div>

            <div class="doc-section">
              <h5>2. System Architecture</h5>
              <p>
                CloudKeeper operates on a
                <strong>Serverless Architecture</strong>. Your Google Drive™
                acts as the sole storage facility for your encrypted vault.
              </p>
            </div>

            <div class="doc-section">
              <h5>3. Encryption Mechanism</h5>
              <p>
                All data entries are secured using <strong>AES-256</strong>.
              </p>
              <div class="alert-box warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Critical Warning:</strong> If you forget your Master
                Password, your data is irretrievable.
              </div>
            </div>

            <div class="doc-section">
              <h5>4. Getting Started</h5>
              <ul class="doc-list">
                <li><strong>Step 1:</strong> Sign in with Google.</li>
                <li><strong>Step 2:</strong> Create Master Password.</li>
                <li><strong>Step 3:</strong> Start adding accounts.</li>
              </ul>
            </div>
          </div>

          <!-- TAB 2: PRIVACY POLICY -->
          <div id="tab-policy" class="tab-content">
            <div class="doc-header">
              <h4>Privacy Policy</h4>
              <p>Last Updated: December 2025</p>
            </div>

            <div class="doc-section">
              <h5>1. Introduction</h5>
              <p>
                CloudKeeper is a standalone, client-side application. We
                prioritize your privacy and data sovereignty.
              </p>
            </div>

            <div class="doc-section">
              <h5>2. Data Collection</h5>
              <p>We adhere to a strictly <strong>No-Logging Policy</strong>.</p>
              <ul class="doc-list">
                <li>
                  We <strong>do not</strong> collect or store your passwords.
                </li>
                <li>We <strong>do not</strong> track your usage behavior.</li>
              </ul>
            </div>

            <div class="doc-section">
              <h5>3. Google Drive Usage</h5>
              <p>
                The Service accesses only specific files created by this app
                (<code>.json</code>) for data persistence.
              </p>
            </div>

            <div class="doc-section">
              <h5>4. Disclaimer</h5>
              <p>
                The Service is provided "as is". The developer is not liable for
                data loss due to forgotten passwords.
              </p>
            </div>

            <div class="doc-footer">
              <p>Developed by Independent Developer.</p>
              <p>Contact: your-email@example.com</p>
            </div>
          </div>
          <!-- End of Tab 2 -->
        </div>
      </div>
    </div>

    <!-- CHANGE PASSWORD MODAL -->
    <div id="change-pass-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3><i class="fas fa-user-lock"></i> Change Master Password</h3>
          <span onclick="closeModal('change-pass-modal')" class="close"
            >&times;</span
          >
        </div>

        <div class="modal-body">
          <div
            class="alert-box warning"
            style="
              margin-bottom: 20px;
              font-size: 13px;
              padding: 10px;
              background: #fef2f2;
              color: #991b1b;
              border: 1px solid #fca5a5;
              border-radius: 8px;
            "
          >
            <i class="fas fa-exclamation-triangle"></i>
            Warning: If you forget your new password, you will lose access to
            all your data forever.
          </div>

          <!-- Current Password -->
          <div class="input-group">
            <label>Current Password</label>
            <div class="pass-box">
              <div class="icon-input">
                <i class="fas fa-lock"></i>
                <input
                  type="password"
                  id="cp-current"
                  placeholder="Enter current password"
                />
              </div>
            </div>
          </div>

          <!-- New Password -->
          <div class="input-group">
            <label>New Password</label>
            <div class="pass-box">
              <div class="icon-input">
                <i class="fas fa-key"></i>
                <input
                  type="password"
                  id="cp-new"
                  placeholder="Enter new password"
                />
              </div>
              <button onclick="togglePassVisibility('cp-new')" class="btn-gen">
                <i class="fas fa-eye"></i>
              </button>
            </div>
          </div>

          <!-- Confirm New Password -->
          <div class="input-group">
            <label>Confirm New Password</label>
            <div class="pass-box">
              <div class="icon-input">
                <i class="fas fa-check-circle"></i>
                <input
                  type="password"
                  id="cp-confirm"
                  placeholder="Repeat new password"
                />
              </div>
            </div>
          </div>

          <div class="modal-footer">
            <button
              onclick="handleChangePassword()"
              class="btn-save"
              style="background: #0f172a"
            >
              Update Password
            </button>
          </div>
        </div>
      </div>
    </div>

    <script
      async
      defer
      src="https://apis.google.com/js/api.js"
      onload="gapiLoaded()"
    ></script>
    <script
      async
      defer
      src="https://accounts.google.com/gsi/client"
      onload="gisLoaded()"
    ></script>

    <script src="script.js"></script>
    <script src="coffee-plugin.js"></script>
  </body>
</html>
