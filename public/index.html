<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>CloudKeeper</title>

    <!-- PWA Settings -->
    <link rel="manifest" href="manifest.json" />
    <link rel="icon" type="image/svg+xml" href="icon.svg" />
    <meta name="theme-color" content="#2563EB" />

    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <!-- 1. LOGIN SCREEN -->
    <div id="login-view" class="view active">
      <div class="login-card">
        <div class="logo-circle"><i class="fas fa-shield-alt"></i></div>
        <h1>CloudKeeper</h1>
        <p>Your Secure Vault on Google Drive</p>
        <button onclick="handleAuthClick()" class="btn-google">
          <img
            src="https://www.svgrepo.com/show/475656/google-color.svg"
            alt="G"
          />
          Sign in with Google
        </button>
        <p class="note">Encrypted & Stored on your Drive.</p>
      </div>
    </div>

    <!-- ★ MASTER PASSWORD SCREEN (NEW) ★ -->
    <div id="unlock-view" class="view" style="display: none">
      <div class="login-card">
        <div class="logo-circle" style="background: #ecfdf5; color: #10b981">
          <i class="fas fa-key"></i>
        </div>
        <h2 id="unlock-title">Unlock Vault</h2>
        <p class="note" id="unlock-msg">Enter Master Password to Decrypt</p>

        <div class="input-group" style="margin-top: 20px">
            <!-- 
                   Browser ကို လှည့်စားရန်:
                   1. autocomplete="new-password" (အသစ်လို့ပြောရင် Browser က ဖြည့်ပေးဖို့ မကြိုးစားဘူး)
                   2. name="search_term" (Password လို့ နာမည်မပေးဘူး)
                -->
          <input 
                    type="password" 
                    id="master-password" 
                    placeholder="Master Password" 
                    style="text-align: center; letter-spacing: 2px;"
                    autocomplete="new-password" 
                    name="vault_unlock_key_unique"
                    readonly 
                    onfocus="this.removeAttribute('readonly');"
                >
        </div>

        <button
          onclick="unlockVault()"
          class="btn-primary"
          style="margin-top: 10px"
        >
          <i class="fas fa-lock-open"></i> Unlock
        </button>

        <p
          class="note"
          style="color: #930e0e; font-size: 13px; margin-top: 15px"
        >
          <i class="fas fa-exclamation-triangle"></i> If you lose this password,
          data is lost forever. <br> Security: Do not save this password in browser.
        </p>
      </div>
    </div>

    <!-- 2. DASHBOARD -->
    <div id="app-view" class="view" style="display: none">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="brand">
          <i class="fas fa-shield-alt"></i> <span>Keeper</span>
        </div>

        <!-- Menu Container (User Panel is now INSIDE for mobile scroll) -->
        <div class="menu-container">
          <button class="menu-item active" onclick="filterData('all')">
            <i class="fas fa-border-all"></i> <span>All Items</span>
          </button>
          <button class="menu-item" onclick="filterData('fav')">
            <i class="fas fa-star text-yellow"></i> <span>Favorites</span>
          </button>

          <div class="menu-label">Categories</div>
          <button class="menu-item" onclick="filterData('social')">
            <i class="fas fa-globe"></i> <span>Social</span>
          </button>
          <button class="menu-item" onclick="filterData('bank')">
            <i class="fas fa-wallet"></i> <span>Finance</span>
          </button>
          <button class="menu-item" onclick="filterData('wireless')">
            <i class="fas fa-wifi"></i> <span>Wireless</span>
          </button>
          <button class="menu-item" onclick="filterData('tv')">
            <i class="fas fa-tv"></i> <span>TV & Ent.</span>
          </button>
          <button class="menu-item" onclick="filterData('auto')">
            <i class="fas fa-car"></i> <span>Auto</span>
          </button>
          <button class="menu-item" onclick="filterData('insurance')">
            <i class="fas fa-file-contract"></i> <span>Insurance</span>
          </button>
          <button class="menu-item" onclick="filterData('home')">
            <i class="fas fa-home"></i> <span>Home</span>
          </button>
          <button class="menu-item" onclick="filterData('work')">
            <i class="fas fa-briefcase"></i> <span>Work</span>
          </button>

          <!-- Help Button -->
          <button class="menu-item" onclick="openGuide()">
            <i class="fas fa-question-circle"></i> <span>Guide & Privacy</span>
          </button>

          <!-- User Panel (Moved Inside) -->
          <div class="user-panel">
            <img
              id="user-avatar"
              src=""
              alt="User"
              onerror="this.src='https://cdn-icons-png.flaticon.com/512/149/149071.png'"
            />
            <div class="user-details">
              <span id="user-name">User</span>
              <button onclick="handleSignoutClick()" class="btn-sm">
                Logout
              </button>
            </div>
          </div>
        </div>
      </aside>

      <!-- Main Content -->
      <main class="main-area">
        <header>
          <div class="search-bar">
            <i class="fas fa-search"></i>
            <input
              type="text"
              id="search-input"
              placeholder="Search vault..."
              onkeyup="renderList()"
            />
          </div>

          <div class="header-actions">
            <div class="view-toggles">
              <button
                class="btn-toggle active"
                id="btn-grid"
                onclick="toggleView('grid')"
              >
                <i class="fas fa-th-large"></i>
              </button>
              <button
                class="btn-toggle"
                id="btn-list"
                onclick="toggleView('list')"
              >
                <i class="fas fa-list"></i>
              </button>
            </div>
            <button onclick="openModal('add')" class="btn-primary">
              <i class="fas fa-plus"></i> <span class="desk-only">Add New</span>
            </button>
          </div>
        </header>

        <div id="sync-status" class="status-bar hidden">
          <i class="fas fa-sync fa-spin"></i> Syncing with Google Drive...
        </div>

        <div id="data-list" class="grid-layout"></div>
      </main>
    </div>

    <!-- ADD/EDIT MODAL -->
    <div id="entry-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <!-- Modal Title ID added -->
          <h3 id="modal-title">
            <i class="fas fa-pen-to-square"></i> New Account
          </h3>
          <span onclick="closeModal()" class="close">&times;</span>
        </div>
        <div class="modal-body">
          <input type="hidden" id="entry-id" />

          <div class="form-grid">
            <div class="input-group">
              <label>Category</label>
              <select id="inp-cat">
                <option value="social">Social Media</option>
                <option value="bank">Finance / Bank</option>
                <option value="wireless">Wireless / Mobile</option>
                <option value="tv">TV / Entertainment</option>
                <option value="auto">Auto / Car</option>
                <option value="insurance">Insurance</option>
                <option value="home">Home / Utilities</option>
                <option value="work">Work / Business</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="input-group">
              <label>Title</label>
              <input type="text" id="inp-title" placeholder="e.g. Netflix" />
            </div>
          </div>

          <div class="input-group">
            <label>Username / ID</label>
            <div class="icon-input">
              <i class="fas fa-user"></i>
              <input type="text" id="inp-user" />
            </div>
          </div>

          <div class="input-group">
            <label>Password</label>
            <div class="pass-box">
              <div class="icon-input">
                <i class="fas fa-key"></i>
                <input type="text" id="inp-pass" />
              </div>
              <button onclick="genPass()" class="btn-gen">
                <i class="fas fa-magic"></i>
              </button>
            </div>
          </div>

          <div class="input-group">
            <label>Notes / Security Q</label>
            <textarea id="inp-note" rows="3"></textarea>
          </div>

          <div class="modal-footer">
            <button onclick="saveEntry()" class="btn-save">
              Save Securely
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- PROFESSIONAL GUIDE MODAL -->
    <div id="guide-modal" class="modal">
      <div class="modal-content modal-large">
        <div class="modal-header no-border">
          <div class="tab-header">
            <button class="tab-link active" onclick="switchTab('manual')">
              User Manual
            </button>
            <button class="tab-link" onclick="switchTab('policy')">
              Privacy Policy
            </button>
          </div>
          <span onclick="closeGuide()" class="close">&times;</span>
        </div>

        <div class="modal-body scroll-body legal-body">
          <!-- USER MANUAL CONTENT -->
          <div id="tab-manual" class="tab-content active">
            <div class="doc-header"><h4>User Manual</h4></div>
                <div class="doc-section">
                    <h5>1. Master Password</h5>
                    <p>When you first use the app, you will set a Master Password. This password is used to encrypt your data before sending it to Google Drive. We do not store this password.</p>
            </div>

            <div class="doc-section">
              <h5>1. System Architecture</h5>
              <p>
                CloudKeeper operates on a
                <strong>Serverless Architecture</strong>. Unlike traditional
                cloud services, we do not maintain a central database of your
                information. Your Google Drive™ acts as the sole storage
                facility for your encrypted vault.
              </p>
            </div>

            <div class="doc-section">
              <h5>2. Encryption Mechanism</h5>
              <p>
                All data entries are secured using
                <strong>AES-256 (Advanced Encryption Standard)</strong> before
                leaving your device. The encryption key is derived solely from
                your Master Password.
              </p>
              <div class="alert-box warning">
                <i class="fas fa-exclamation-triangle"></i>
                <strong>Critical Warning:</strong> Since we utilize a
                Zero-Knowledge protocol, we do not store your Master Password.
                If you forget it, your data is cryptographically irretrievable.
              </div>
            </div>

            <div class="doc-section">
              <h5>3. Getting Started</h5>
              <ul class="doc-list">
                <li>
                  <strong>Step 1 (Authentication):</strong> Authenticate using
                  your Google Account to establish a secure connection with
                  Google Drive API.
                </li>
                <li>
                  <strong>Step 2 (Vault Creation):</strong> Upon first login,
                  you will be prompted to create a Master Password. Ensure this
                  is strong and memorable.
                </li>
                <li>
                  <strong>Step 3 (Synchronization):</strong> Changes made to
                  your vault are automatically synced to
                  <code>cloud_keeper_data_v3.json</code> in your Drive's AppData
                  folder.
                </li>
              </ul>
            </div>
          </div>

          <!-- PRIVACY POLICY CONTENT -->
          <div id="tab-policy" class="tab-content">
            <div class="doc-header">
                <h4>Privacy Policy</h4>
            </div>
                 <p>Your data is encrypted using AES-256 algorithm.</p>
          </div>

            <div class="doc-section">
              <h5>1. Introduction</h5>
              <p>
                CloudKeeper ("the Service") is developed as a standalone,
                client-side application designed to provide secure data
                management. We are committed to protecting your privacy and
                ensuring you maintain full sovereignty over your data.
              </p>
            </div>

            <div class="doc-section">
              <h5>2. Data Sovereignty & Collection</h5>
              <p>
                We adhere to a strictly <strong>No-Logging Policy</strong>. The
                Service functions as a conduit between your device and your
                personal Google Drive storage.
              </p>
              <ul class="doc-list">
                <li>
                  We <strong>do not</strong> collect, store, or transmit your
                  passwords, usernames, or notes to any external server other
                  than your own Google Drive.
                </li>
                <li>
                  We <strong>do not</strong> use analytics cookies or trackers
                  to monitor your usage behavior.
                </li>
              </ul>
            </div>

            <div class="doc-section">
              <h5>3. Google Drive API Usage</h5>
              <p>
                The Service creates and accesses specific files within your
                Google Drive storage for the sole purpose of data persistence.
                This access is limited to:
              </p>
              <ul>
                <li>
                  Reading and writing the encrypted vault file
                  (<code>.json</code>).
                </li>
                <li>
                  The App cannot access, read, or delete any other files in your
                  Google Drive.
                </li>
              </ul>
            </div>

            <div class="doc-section">
              <h5>4. Disclaimer of Liability</h5>
              <p>
                The Service is provided "as is", without warranty of any kind.
                The developer shall not be liable for any data loss or damages
                arising from the use of this software, including but not limited
                to the loss of the Master Password.
              </p>
            </div>

            <div class="doc-footer">
              <p>Developed by Independent Developer.</p>
              <p>Contact: your-email@example.com</p>
            </div>
          </div>
        </div>
      </div>
    </div>

    <script
      async
      defer
      src="https://apis.google.com/js/api.js"
      onload="gapiLoaded()"
    ></script>
    <script
      async
      defer
      src="https://accounts.google.com/gsi/client"
      onload="gisLoaded()"
    ></script>
    <script src="script.js"></script>
  </body>
</html>
